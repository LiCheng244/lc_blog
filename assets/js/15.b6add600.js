(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{456:function(v,t){v.exports="data:image/png;base64,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5FBx4403puzfcccd8uCDD+Z1bpavlIiIiG3beZefS8bRwKHwdMjaRaPRgxbc0NAgO3fuTO5XVVX1iqji4mIREXEcJ0N+98dWpkyZInV1daK1lnHjxsn27dvFtu0jRnz3evYEY0zORjhkbdatW9djnqamJrnnnnukurpagsFgViWUUinEAbJ06VJpamoSEZHW1taM89L3Y7GYzJs3T0REIpGIXH311eI4TladGhoaxHXdvOrouq7U1dXJhx9+mJEWDAbl4osvlk2bNskDDzwgwWBQHMeRzs7OI0v0u+++e9D0O+64I2daOBzuUiDN8hL7b775pnz88ccyf/58aWtrkzfeeEPWrFkjs2bNkl27dsmtt96abIwE2QlyEv+7w3Ecqa+vl7feektuvPFGmTVrljiOI5deeqmcd955MmvWLFm+fHlOwhPWmmiktrY2WbhwoYiIbNmyRUREnn76aXnttddk1apVct1116U06CET3d7enjPt9ttvT/5//fXXs5Kc+M32FFtRUZG8//77cuedd8pNN90k0WhUXn/9dVmzZo08//zzsm3bNrnxxhtl0KBBsnjxYolEIrJs2TJpbGyU1atXyy233CLf+973ZNWqVfLkk0/Kq6++KuFwWN577z156623UvRJdw27du2SmTNnJrdzzz1Xli5dKnv27JF58+bJI488kmy4xJUVCoVk5cqVcuDAAYnFYrJ8+XJ56KGHUg1IDr3/y/sSTOCjjz6SlpaWVAVyWLTrurJy5Uqpq6uT2tpaWbt2rYTDYYlEItLS0iL33nuvVFZWysaNG0VEZO/evVJZWSmRSET+8Ic/yKeffioiIqtWrZI33nhDwuGwfPDBB/Lmm2+KiMgPfvCDpEXX1NTIT37yk+Q52fD222/L/Pnzpbm5WUREduzYIfX19XLttdfKRRddJPfcc49Eo1HZs2ePXHnllRnfyjqsl4Vc1+3VGPm0005L2d+xYwdkWSSfPHkyJSUlGGOor6/nySefZMSIESxbtoy1a9fS2trKwIED+eMf/0hlZSWhUIiOjg4++eQThg8fzoQJE/D7/YgIwWAw+RhAaWlpyncLtNZoramoqGDEiBE59d6wYQOPPvooS5YsST4uPHLkSACWLl2Kbdv4fD527dpFZWUlDz/8cMZHFezDiWjr8/mor69n+PDhvTovMR5tamrKOkP85JNPMMZkRD+fOHEit912Gx0dHRQXF/P000/zl7/8hTPOOINbb72VxYsX09DQwJgxY2hsbKS9vZ329naGDx9OY2MjgwYNYvfu3b3S889//jMrVqzg7rvvZvTo0cm0SCSC67rcf//9XHbZZZx66qkMHTqUCy64AJ/PxzPPPENFRQVnn32216iHTrOH4cOHc/PNN+O6LpWVlaxcuTLr5CadTIBp06YlyUzfJkyYwNVXX83OnTtpb28nHA5TXV3N/PnzmT17NrNnz+bMM8+kra0Nn89HW1sb48aNo6amhueee4729nYikQgtLS3Ytk1RURFDhw5l69atKbrcdtttADQ3N6ccj8Vi/PznP2f16tX89re/ZdKkSVnrceaZZzJ27Fiam5u56KKLmDdvHgAvv/wyBw4cSGm1w0Jra2vGsfr6+h7Pe/bZZzOOGWMyfHZjY6O888478uKLL8qyZcuktbVVHnnkERk/frxorWX27NlSX18v3/3ud5Pj6okTJ8ro0aPFcRy54YYbkr63ra1NZs+eLZ2dnTJjxgwxxsjll18uP/3pT+X666+XhoYGERHZvHmzGGPkpZdeyjqCSfRNnZ2dsm7dOnn//fclGAzKlVdemcxzySWXpPRHh/1CZ7b7Y8OGDWPNmjWcddZZOc+74oorclo68cceXnrpJV555RWWLFlCcXExzc3NbNiwgaFDh/L4448zfvx4Ro4cmfLR4W4GhOM47Nixg3HjxiEiPPDAA8yYMYPCwkKef/75ZL7bb7+d8vJyAPbv38+vfvUr7rrrLqZPn56ypuE4Dps2baKqqgrbtnnqqacoKiri+9//PmeccQa/+93vctb3qL05e9ZZZ+G6Lo8//jhbt27lhBNOoKqqivPPP585c+b0+IjZyy+/TEtLC0888QSDBg3iT3/6E4FAgHPPPZcDBw7wwgsvEIvFGDVqVLJT7Y5f/vKXrFu3jnPOOYeioiLa29sJhUJcc801AEliE31BAmvWrOHSSy9l/Pjx/P73v2ft2rU0NTXhui5+vx+fz8fMmTOZMmUKS5YsYfz48ViWxa5du7j22mspKipizJgxtLe3pxqRfAnrjAf7ihxZF28UoVAIcnwiqevDvQdvvJ7KTRDvum7Ge409IRKJUFdXx/HHHw/Azp07GTNmTHKp9Jh9RTkfUr5KOGYXinv8qORXDP8Pzz8Mg7EeiC8AAAAASUVORK5CYII="},457:function(v,t,i){v.exports=i.p+"assets/img/201019201.e765d440.png"},458:function(v,t,i){v.exports=i.p+"assets/img/201019203.1bbbb1d5.png"},459:function(v,t,i){v.exports=i.p+"assets/img/201019202.ac17a7b9.png"},460:function(v,t,i){v.exports=i.p+"assets/img/201019204.4db9cf6d.png"},653:function(v,t,i){"use strict";i.r(t);var a=i(6),_=Object(a.a)({},(function(){var v=this,t=v.$createElement,a=v._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[a("h1",[v._v("1亿数据的用户中心架构如何设计？")]),v._v(" "),a("br"),v._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[v._v("前言")]),v._v(" "),a("p",[v._v("用户中心，几乎是所有互联网公司，必备的子系统。随着数据量不断增加，吞吐量不断增大，用户中心的架构，该如何演进呢。")])]),v._v(" "),a("br"),v._v(" "),a("h2",{attrs:{id:"一-什么是用户中心业务？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-什么是用户中心业务？"}},[v._v("#")]),v._v(" 一. 什么是用户中心业务？")]),v._v(" "),a("p",[v._v("用户中心是一个通用业务，主要  "),a("code",[v._v("『 提供用户注册、登录、信息查询与修改的服务 』")]),v._v("。")]),v._v(" "),a("h3",{attrs:{id:"_2-用户中心的数据结构是怎么样的？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-用户中心的数据结构是怎么样的？"}},[v._v("#")]),v._v(" 2. 用户中心的数据结构是怎么样的？")]),v._v(" "),a("p",[v._v("用户中心的核心数据结构为： "),a("code",[v._v("User(uid, login_name, passwd, sex, age, nickname, …)")])]),v._v(" "),a("p",[v._v("其中：")]),v._v(" "),a("ul",[a("li",[v._v("uid为用户ID，为主键；")]),v._v(" "),a("li",[v._v("login_name, passwd, sex 等是用户属性；")])]),v._v(" "),a("h3",{attrs:{id:"_3-系统架构又是怎么样的呢？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-系统架构又是怎么样的呢？"}},[v._v("#")]),v._v(" 3. 系统架构又是怎么样的呢？")]),v._v(" "),a("p",[v._v("在业务初期，单库单表，配合用户中心微服务，就能满足绝大部分业务需求，其典型的架构为：")]),v._v(" "),a("p",[a("img",{attrs:{src:i(456),alt:""}})]),v._v(" "),a("ul",[a("li",[a("code",[v._v("user-center")]),v._v("：用户中心服务，对调用者提供友好的RPC接口；")]),v._v(" "),a("li",[a("code",[v._v("user-db")]),v._v("：对用户进行数据存储；")])]),v._v(" "),a("h3",{attrs:{id:"_4-当数据量越来越大，例如达到1亿注册量时，会出现什么问题呢？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-当数据量越来越大，例如达到1亿注册量时，会出现什么问题呢？"}},[v._v("#")]),v._v(" 4. 当数据量越来越大，例如达到1亿注册量时，会出现什么问题呢？")]),v._v(" "),a("p",[v._v("随着数据量越来越大，单库无法承载所有的数据，此时 "),a("code",[v._v("『 需要对数据库进行水平切分 』")]),v._v("。")]),v._v(" "),a("p",[v._v("常见的水平切分算法有 "),a("code",[v._v("“范围法”")]),v._v(" 和 "),a("code",[v._v("“哈希法”")]),v._v("。")]),v._v(" "),a("br"),v._v(" "),a("h2",{attrs:{id:"二-什么是范围法？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-什么是范围法？"}},[v._v("#")]),v._v(" 二. 什么是范围法？")]),v._v(" "),a("p",[v._v("范围法，以用户中心的业务主键uid为划分依据，采用区间的方式，将数据水平切分到两个数据库实例上去：")]),v._v(" "),a("p",[a("img",{attrs:{src:i(457),alt:""}})]),v._v(" "),a("ul",[a("li",[a("code",[v._v("user-db1")]),v._v("：存储0到1千万的uid数据；")]),v._v(" "),a("li",[a("code",[v._v("user-db2")]),v._v("：存储1千万到2千万的uid数据；")])]),v._v(" "),a("h3",{attrs:{id:"_1-优点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-优点"}},[v._v("#")]),v._v(" 1. 优点")]),v._v(" "),a("ul",[a("li",[a("code",[v._v("切分策略简单")]),v._v(": 根据uid，按照范围，user-center很快能够定位到数据在哪个库上；")]),v._v(" "),a("li",[a("code",[v._v("扩容简单")]),v._v(": 如果容量不够，只要增加user-db3，拓展2千万到3千万的uid即可；")])]),v._v(" "),a("h3",{attrs:{id:"_2-缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-缺点"}},[v._v("#")]),v._v(" 2. 缺点")]),v._v(" "),a("ul",[a("li",[a("code",[v._v("uid必须要满足递增的特性")]),v._v("；")]),v._v(" "),a("li",[a("code",[v._v("数据量不均")]),v._v("，新增的user-db3，在初期的数据会比较少；")]),v._v(" "),a("li",[a("code",[v._v("请求量不均")]),v._v("，一般来说，新注册的用户活跃度会比较高，故user-db2往往会比user-db1负载要高，导致服务器利用率不平衡；")])]),v._v(" "),a("p",[v._v("画外音：数据库层面的负载均衡，既要考虑数据量的均衡，又要考虑负载的均衡。")]),v._v(" "),a("br"),v._v(" "),a("h2",{attrs:{id:"三-什么是哈希法？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-什么是哈希法？"}},[v._v("#")]),v._v(" 三. 什么是哈希法？")]),v._v(" "),a("p",[v._v("哈希法，也是以用户中心的业务主键uid为划分依据，采用哈希的方式，将数据水平切分到两个数据库实例上去：")]),v._v(" "),a("p",[a("img",{attrs:{src:i(458),alt:""}})]),v._v(" "),a("ul",[a("li",[a("code",[v._v("user-db1")]),v._v("：存储奇数的uid数据；")]),v._v(" "),a("li",[a("code",[v._v("user-db2")]),v._v("：存储偶数的uid数据；")])]),v._v(" "),a("h3",{attrs:{id:"_1-优点-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-优点-2"}},[v._v("#")]),v._v(" 1. 优点")]),v._v(" "),a("ul",[a("li",[a("code",[v._v("切分策略简单")]),v._v("，根据uid，按照hash，user-center很快能够定位到数据在哪个库上；")]),v._v(" "),a("li",[a("code",[v._v("数据量均衡")]),v._v("，只要uid是随机的，数据在各个库上的分布一定是均衡的；")]),v._v(" "),a("li",[a("code",[v._v("请求量均衡")]),v._v("，只要uid是随机的，负载在各个库上的分布一定是均衡的；")])]),v._v(" "),a("p",[v._v("画外音：如果采用分布式id生成器，id的生成，一般都是随机的。")]),v._v(" "),a("h3",{attrs:{id:"_2-缺点-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-缺点-2"}},[v._v("#")]),v._v(" 2. 缺点")]),v._v(" "),a("ul",[a("li",[a("code",[v._v("扩容麻烦")]),v._v(" ，如果容量不够，要增加一个库，重新hash可能会导致数据迁移；")])]),v._v(" "),a("br"),v._v(" "),a("h2",{attrs:{id:"四-水平切分后有什么新的问题呢？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四-水平切分后有什么新的问题呢？"}},[v._v("#")]),v._v(" 四. 水平切分后有什么新的问题呢？")]),v._v(" "),a("p",[v._v("使用uid来进行水平切分之后，"),a("code",[v._v("对于uid属性上的查询，可以直接路由到库")]),v._v(" ，假设访问uid=124的数据，取模后能够直接定位db-user1：")]),v._v(" "),a("p",[a("img",{attrs:{src:i(459),alt:""}})]),v._v(" "),a("p",[v._v("但 "),a("code",[v._v("对于非uid属性上的查询，就悲剧了")]),v._v(" ，例如login_name属性上的查询：")]),v._v(" "),a("p",[a("img",{attrs:{src:i(460),alt:""}})]),v._v(" "),a("p",[v._v("假设访问login_name=shenjian的数据，由于不知道数据落在哪个库上，"),a("code",[v._v("往往需要遍历所有库")]),v._v("，当分库数量多起来，性能会显著降低。")]),v._v(" "),a("br"),v._v(" "),a("h2",{attrs:{id:"五-非uid属性查询-有哪些业务场景？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五-非uid属性查询-有哪些业务场景？"}},[v._v("#")]),v._v(" 五. 非uid属性查询,有哪些业务场景？")]),v._v(" "),a("p",[v._v("任何脱离业务的架构设计都是耍流氓。")]),v._v(" "),a("p",[v._v("在进行架构讨论之前，先来对业务进行简要分析，用户中心非uid属性上，有两类典型的业务需求。")]),v._v(" "),a("h3",{attrs:{id:"_1-用户侧"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-用户侧"}},[v._v("#")]),v._v(" 1. 用户侧")]),v._v(" "),a("p",[v._v("第一大类 "),a("strong",[v._v("用户侧")]),v._v(": 前台访问，最典型的有两类需求：")]),v._v(" "),a("ul",[a("li",[a("code",[v._v("用户登录")]),v._v("：通过登录名login_name查询用户的实体，1%请求属于这种类型；")]),v._v(" "),a("li",[a("code",[v._v("用户信息查询")]),v._v("：登录之后，通过uid来查询用户的实例，99%请求属这种类型；")])]),v._v(" "),a("p",[v._v("用户侧的查询，基本上是 "),a("code",[v._v("单条记录的查询，访问量较大，服务需要高可用，并且对一致性的要求较高")]),v._v("。")]),v._v(" "),a("h3",{attrs:{id:"_2-运营侧"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-运营侧"}},[v._v("#")]),v._v(" 2. 运营侧")]),v._v(" "),a("p",[v._v("第一大类 "),a("strong",[v._v("运营侧")]),v._v(": 后台访问，根据产品、运营需求，访问模式各异，按照年龄、性别、头像、登陆时间、注册时间来进行查询。")]),v._v(" "),a("p",[v._v("运营侧的查询，基本上是\t"),a("code",[v._v("批量分页")]),v._v(" 的查询，由于是内部系统，"),a("code",[v._v("访问量很低，对可用性的要求不高，对一致性的要求也没这么严格")]),v._v("。")]),v._v(" "),a("h3",{attrs:{id:"_3-对于这两类不同的业务需求，用什么样的架构方案来解决呢？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-对于这两类不同的业务需求，用什么样的架构方案来解决呢？"}},[v._v("#")]),v._v(" 3. 对于这两类不同的业务需求，用什么样的架构方案来解决呢？")]),v._v(" "),a("p",[v._v("总的来说，针对这两类业务需求，架构设计的核心思路为：")]),v._v(" "),a("ul",[a("li",[v._v("用户侧，采用“建立非uid属性到uid的映射关系”的架构方案；")]),v._v(" "),a("li",[v._v("运营侧，采用“前台与后台分离”的架构方案；")])]),v._v(" "),a("h3",{attrs:{id:"_4-用户侧，如何实施-建立非uid属性到uid的映射关系-呢？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-用户侧，如何实施-建立非uid属性到uid的映射关系-呢？"}},[v._v("#")]),v._v(" 4. 用户侧，如何实施“建立非uid属性到uid的映射关系”呢？")]),v._v(" "),a("p",[v._v("常见的方法有四种：")]),v._v(" "),a("ul",[a("li",[a("code",[v._v("索引表法")]),v._v("；")]),v._v(" "),a("li",[a("code",[v._v("缓存映射法")]),v._v("；")]),v._v(" "),a("li",[a("code",[v._v("生成uid法")]),v._v("；")]),v._v(" "),a("li",[a("code",[v._v("基因法")]),v._v("；")])]),v._v(" "),a("p",[v._v("接下来，咱们一一介绍。")]),v._v(" "),a("br"),v._v(" "),a("h2",{attrs:{id:"六-什么是索引表法？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六-什么是索引表法？"}},[v._v("#")]),v._v(" 六. 什么是索引表法？")]),v._v(" "),a("p",[v._v("索引表法的思路是：uid能直接定位到库，login_name不能直接定位到库，如果 "),a("code",[v._v("『 通过login_name能查询到uid 』")]),v._v("，问题便能得到解决。")]),v._v(" "),a("h3",{attrs:{id:"_1-解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-解决方案"}},[v._v("#")]),v._v(" 1. 解决方案")]),v._v(" "),a("ul",[a("li",[v._v("建立一个索引表记录login_name与uid的映射关系；")]),v._v(" "),a("li",[v._v("用login_name来访问时，"),a("code",[v._v("先通过索引表查询到uid，再通过uid定位相应的库")]),v._v("；")]),v._v(" "),a("li",[v._v("索引表属性较少，可以容纳非常多数据，一般不需要分库；")]),v._v(" "),a("li",[v._v("如果数据量过大，可以通过login_name来分库；")])]),v._v(" "),a("h3",{attrs:{id:"_2-缺点-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-缺点-3"}},[v._v("#")]),v._v(" 2. 缺点")]),v._v(" "),a("p",[v._v("数据访问，"),a("code",[v._v("会增加一次数据库查询")]),v._v("，性能会有所下降。")]),v._v(" "),a("br"),v._v(" "),a("h2",{attrs:{id:"七-什么是缓存映射法？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#七-什么是缓存映射法？"}},[v._v("#")]),v._v(" 七. 什么是缓存映射法？")]),v._v(" "),a("p",[v._v("缓存映射法的思路是：访问索引表性能较低，"),a("code",[v._v("把映射关系放在缓存里")]),v._v("，能够提升性能。")]),v._v(" "),a("h3",{attrs:{id:"_1-解决方案-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-解决方案-2"}},[v._v("#")]),v._v(" 1. 解决方案")]),v._v(" "),a("ul",[a("li",[v._v("login_name查询先到cache中查询uid，再根据uid定位数据库；")]),v._v(" "),a("li",[v._v("假设cache miss，扫描所有分库，获取login_name对应的uid，放入cache；")]),v._v(" "),a("li",[a("code",[v._v("login_name到uid的映射关系不会变化，映射关系一旦放入缓存，不会更改，无需淘汰，缓存命中率超高")]),v._v(";")]),v._v(" "),a("li",[v._v("如果数据量过大，可以通过login_name进行cache水平切分；")])]),v._v(" "),a("h3",{attrs:{id:"_2-缺点-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-缺点-4"}},[v._v("#")]),v._v(" 2. 缺点")]),v._v(" "),a("p",[a("code",[v._v("仍然多了一次网络交互")]),v._v(" ，即一次cache查询。")]),v._v(" "),a("br"),v._v(" "),a("h2",{attrs:{id:"八-什么是生成uid法？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#八-什么是生成uid法？"}},[v._v("#")]),v._v(" 八. 什么是生成uid法？")]),v._v(" "),a("p",[v._v("生成uid法的思路是："),a("code",[v._v("不进行远程查询，由login_name直接得到uid")]),v._v("。")]),v._v(" "),a("h3",{attrs:{id:"_1-解决方案-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-解决方案-3"}},[v._v("#")]),v._v(" 1. 解决方案")]),v._v(" "),a("ul",[a("li",[v._v("在用户注册时，"),a("code",[v._v("设计函数login_name生成uid")]),v._v("，uid=f(login_name)，按uid分库插入数据；")]),v._v(" "),a("li",[v._v("用login_name来访问时，先通过函数计算出uid，即uid=f(login_name)再来一遍，由uid路由到对应库；")])]),v._v(" "),a("h3",{attrs:{id:"_2-缺点-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-缺点-5"}},[v._v("#")]),v._v(" 2. 缺点")]),v._v(" "),a("p",[v._v("该函数设计需要非常讲究技巧，且有"),a("code",[v._v("uid生成冲突风险")]),v._v("。")]),v._v(" "),a("p",[v._v("画外音：uid冲突，是业务无法接受的，故生产环境中，一般不使用这个方法。")]),v._v(" "),a("h2",{attrs:{id:"九-什么是基因法？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#九-什么是基因法？"}},[v._v("#")]),v._v(" 九. 什么是基因法？")]),v._v(" "),a("p",[v._v("基因法的思路是：不能用login_name生成uid，但可以"),a("code",[v._v("从login_name抽取“基因”，融入uid中")]),v._v("。")]),v._v(" "),a("p",[v._v("假设分8库，采用uid%8路由，潜台词是，uid的最后3个bit决定这条数据落在哪个库上，这3个bit就是所谓的“基因”。")]),v._v(" "),a("h3",{attrs:{id:"_1-解决方案-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-解决方案-4"}},[v._v("#")]),v._v(" 1. 解决方案")]),v._v(" "),a("p",[v._v("（1）在用户注册时，设计函数login_name生成3bit基因，login_name_gene = f(login_name)，如上图粉色部分；\n（2）同时，生成61bit的全局唯一id，作为用户的标识，如上图绿色部分；\n（3）接着把3bit的login_name_gene也作为uid的一部分，如上图屎黄色部分；\n（4）生成64bit的uid，由id和login_name_gene拼装而成，并按照uid分库插入数据；\n（5）用login_name来访问时，先通过函数由login_name再次复原3bit基因，login_name_gene = f(login_name)，通过login_name_gene%8直接定位到库；\n画外音：基因法，有点意思，在分库时经常使用。")]),v._v(" "),a("hr"),v._v(" "),a("br"),v._v(" "),a("br"),v._v(" "),a("blockquote",[a("p",[v._v("作者： 小黄鸭编程社区")]),v._v(" "),a("p",[v._v("来源： 小黄鸭编程社区")]),v._v(" "),a("p",[v._v("链接："),a("a",{attrs:{href:"https://www.cnblogs.com/three-fighter/p/13641835.html",target:"_blank",rel:"noopener noreferrer"}},[v._v("https://www.cnblogs.com/three-fighter/p/13641835.html"),a("OutboundLink")],1)]),v._v(" "),a("br"),v._v(" "),a("p",[v._v("著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。")])]),v._v(" "),a("br"),v._v(" "),a("br")])}),[],!1,null,null,null);t.default=_.exports}}]);