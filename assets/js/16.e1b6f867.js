(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{239:function(t,s,a){t.exports=a.p+"assets/img/18121700.b23edb46.jpg"},240:function(t,s,a){t.exports=a.p+"assets/img/18121702.5b82fe16.jpeg"},241:function(t,s,a){t.exports=a.p+"assets/img/18121701.c104752e.jpg"},409:function(t,s,a){"use strict";a.r(s);var n=a(6),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",[t._v("Xcode10/iOS12 获取 WiFi 信息")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("引言:")]),t._v(" "),n("p",[t._v("在一些特定业务场景下，我们需要获取 iOS 设备所连接的 WiFi 的信息，比如 WiFi 的 SSID（即 WiFi 的名称），WiFi 的 BSSID（即 WiFi 的路由器的 Mac 地址）等，相应的代码也很简单。")])]),t._v(" "),n("br"),t._v(" "),n("h2",{attrs:{id:"一-常规获取代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-常规获取代码"}},[t._v("#")]),t._v(" 一. 常规获取代码")]),t._v(" "),n("div",{staticClass:"language-objectivec extra-class"},[n("pre",{pre:!0,attrs:{class:"language-objectivec"}},[n("code",[t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取 wifi")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[n("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("SystemConfiguration"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("CaptiveNetwork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("h"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")])])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[n("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("NetworkExtension"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("NetworkExtension"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("h"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")])])]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取 wifi 信息")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSString "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("wifiSSID "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \n    CFArrayRef wifis "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("CNCopySupportedInterfaces")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wifis "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" nil "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("CFArrayGetCount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wifis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" nil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    NSArray "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("interfaces "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__bridge_transfer id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("wifis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    NSDictionary "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("info "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSDictionary dictionary"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSString "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" interfaces"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        info "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__bridge_transfer NSDictionary "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("CNCopyCurrentNetworkInfo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__bridge CFStringRef"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("info "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" nil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" nil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    NSString "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("ssid "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"SSID"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    NSString "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("bssid "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"BSSID"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSLog")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"wifi name: %@ - %@"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ssid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bssid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ssid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),n("p",[t._v("在"),n("code",[t._v("Xcode 10（iOS 12）")]),t._v("之前，上述代码可以正常运行取到结果，但当升级到 Xcode 10 后编译工程在 iOS 12 上运行时，同样的代码却无法取得 WiFi 的信息。通过断点调试发现"),n("code",[t._v("CNCopyCurrentNetworkInfo(...)")]),t._v(" 函数总是返回 nil，查阅官方 API 文档，发现该函数的描述多了一条重要提示，如下图红框内容：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(239),alt:""}})]),t._v(" "),n("p",[t._v("大致意思是：")]),t._v(" "),n("blockquote",[n("p",[t._v("在iOS 12+中使用此方法需要在Xcode中为应用授权获取WiFi信息的能力。授权后，Xcode会自动在App ID和应用的权限列表中增加获取WiFi信息的权限。")])]),t._v(" "),n("br"),t._v(" "),n("h2",{attrs:{id:"二-xcode10配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-xcode10配置"}},[t._v("#")]),t._v(" 二. Xcode10配置")]),t._v(" "),n("p",[t._v("首先更改 证书，添加 "),n("code",[t._v("Access WiFi Information")]),t._v(" 选项:")]),t._v(" "),n("p",[n("img",{attrs:{src:a(240),alt:""}})]),t._v(" "),n("p",[t._v("在 Xcode 工程中授权获取 WiFi 信息的能力，开启路径为："),n("code",[t._v("Xcode -> [Project Name] -> Targets -> [Target Name] -> Capabilities -> Access WiFi Information -> ON")]),t._v("，如下图：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(241),alt:""}})]),t._v(" "),n("p",[t._v("设置完毕后，我们可以发现在工程的 "),n("code",[t._v(".entitlements")]),t._v(" 文件会多了一对键值：")]),t._v(" "),n("div",{staticClass:"language-objectivec extra-class"},[n("pre",{pre:!0,attrs:{class:"language-objectivec"}},[n("code",[t._v("Access WiFi Information "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" YES\n")])])]),n("p",[t._v("至此，我们就可以正常在 iOS 12+ 中获取 WiFi 的信息了。")]),t._v(" "),n("br")])}),[],!1,null,null,null);s.default=r.exports}}]);